#!/usr/bin/env python3

import json
import os
import subprocess
import sys

notification = json.loads(sys.stdin.read())

message = notification.get('message')
cwd = notification.get('cwd')

# Check if we're in tmux and if this window is currently active
tmux_pane = os.environ.get('TMUX_PANE')
window_is_active = False

if tmux_pane:
    result = subprocess.run(
        ['tmux', 'display-message', '-p', '-t', tmux_pane, '#{window_active}'],
        capture_output=True,
        text=True
    )
    window_is_active = result.stdout.strip() == '1'

# Skip notification if already looking at this window
if window_is_active:
    sys.exit(0)

# Extract project name from cwd
if cwd is not None:
    message += f' ({cwd})'

# Desktop notification with project name
subprocess.run(['notify-send', 'Claude Code', message])

# Play sound
subprocess.run(['paplay', '--volume=32768', '/usr/share/sounds/freedesktop/stereo/complete.oga'])

# Terminal bell (highlights tmux pane)
print('\a', end='', flush=True)
