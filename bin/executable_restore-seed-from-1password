#!/bin/bash
set -euo pipefail

ITEM_NAME="Seed - bootstrap keys"

# Create directories if needed
mkdir -p ~/.keys ~/.ssh ~/.gnupg

# Download and extract
op document get "$ITEM_NAME" | tar xJvf - -C ~

# Fix permissions
chmod 700 ~/.keys ~/.ssh ~/.gnupg
chmod 600 ~/.keys/* ~/.ssh/christian_dedekind ~/.ssh/google_compute_engine ~/.ssh/config

# Import GPG keys (public + private, passphrase-protected)
gpg --import ~/.gnupg/git-signing-key.gpg

# Set ultimate trust on our own key
echo "$(git config user.signingkey):6:" | gpg --import-ownertrust

echo "Keys restored."
