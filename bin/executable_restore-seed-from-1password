#!/bin/bash
set -euo pipefail

ITEM_NAME="Seed - bootstrap keys"

# Create directories if needed
mkdir -p ~/.keys ~/.ssh ~/.gnupg/private-keys-v1.d

# Download and extract
op document get "$ITEM_NAME" | tar xJf - -C ~

# Fix permissions
chmod 700 ~/.keys ~/.ssh ~/.gnupg ~/.gnupg/private-keys-v1.d
chmod 600 ~/.keys/* ~/.ssh/christian_dedekind ~/.ssh/google_compute_engine ~/.ssh/config
chmod 600 ~/.gnupg/private-keys-v1.d/*

echo "Keys restored."
